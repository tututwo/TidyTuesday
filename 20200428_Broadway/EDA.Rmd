---
title: "EDA"
author: "Tu"
date: "7/14/2020"
output: html_document
---

# Which musicals are those theatres showing throughout the years?????
```{r}
library(tidyverse)
library(tidytuesdayR)
library(lubridate)

theme_set(theme_minimal())
```
```{r}
data <- tidytuesdayR::tt_load(2020, week = 18)

#pre1985 <- data$`pre-1985-starts`
grosses <- data$grosses
# skimr::skim(grosses)
```
```{r}
grosses %>% 
  mutate(year = year(date(week_ending)))%>%
  group_by(year) %>% 
  mutate(median_pc = median(pct_capacity)) %>% 
  filter(pct_capacity > median_pc) %>% 
  ungroup() %>% 
  distinct(show)

```
```{r}
grosses %>% 
  ggplot()+
  geom_histogram(aes(performances))
```

```{r}
grosses %>% 
  ggplot()+
  geom_col(aes(x = as.Date(week_ending), y = performances))
  
```
## correlation between pct_capacity and total performance

```{r fig.height=10, fig.width=10}
grosses %>% 
  mutate(total_perform = performances + previews) %>% 
  ggplot(aes(total_perform, pct_capacity)) +
  geom_jitter() +
  scale_x_continuous()
```
```{r}
grosses %>% 
  ggplot()+
  geom_histogram(aes(weekly_gross))
```

```{r}
no_income <- grosses %>% 
  filter(weekly_gross == 0)
```
## I wonder which show in which theatre achieved this?


## how can previews contribute the success/failure of the show

```{r}
ggplot(grosses) +
  geom_histogram(aes(pct_capacity))
```

```{r fig.height=15, fig.width=15}
grosses %>% 
  group_by(show) %>% 
  summarise(total_preview = sum(previews),
            total_gross = sum(weekly_gross)) %>% 
  ggplot() +
  geom_point(aes(total_preview, total_gross, colour = show)) +

  theme(legend.position = "none")

```
## most shows have 0-50 previews. The most selling lion king has 34. What is the healthy amount of preview should a show have?
```{r}
grosses %>% 
  group_by(show) %>% 
  summarise(total_preview = sum(previews),
            total_gross = sum(weekly_gross)) %>% 
  ggplot()+
  geom_histogram(aes(total_preview))
```


```{r}
grosses %>% 
  group_by(show) %>% 
  summarise(total_preview = sum(previews),
            total_gross = sum(weekly_gross)) %>% 
  filter(total_gross < median(total_gross)) %>% 
  ggplot()+
  geom_histogram(aes(total_preview))
```
```{r}
grosses %>% 
  group_by(show) %>% 
  summarise(total_preview = sum(previews),
            total_gross = sum(weekly_gross)) %>% 
  filter(total_gross > median(total_gross)) %>% 
  ggplot()+
  geom_histogram(aes(total_preview))
```

```{r}
grosses %>% 
  filter(show %in% c("Hamilton", "Cats", "Les Misérables")) %>% 
  ggplot(aes(week_ending, weekly_gross, colour = show)) +
  geom_line() +
  scale_y_continuous(labels = scales::dollar) +
  expand_limits(y = 0)

```
## what is the show that performs the most in Broadway history
```{r}
grosses %>% 
  count(show, sort = T)

# this is how many weeeks has each show presented
```
```{r}
# total performance = performance/week * n of weeks
top_100 <- grosses %>% 
  group_by(show) %>% 
  summarise(total_performance = sum(performances+previews)) %>% 
  arrange(desc(total_performance)) %>% 
  slice(c(1:100)) %>% 
  select(show)
```
```{r}
grosses %>% 
  group_by(theatre) %>% 
  summarise(total_perfom = sum(performances)) %>% 
  arrange(desc(total_perfom))
```

```{r}
theatre_year <- 
grosses %>% 
  mutate(year = year(date(week_ending)),
         month = month(date(week_ending))) %>%
  group_by(theatre, year) %>% 
  summarise(sum_year_thea = sum(performances)) 
```
```{r fig.height=20, fig.width=12}
#library(ggchicklet)
theatre_year %>% 
  ggplot() +
  geom_chicklet(aes(theatre, sum_year_thea, fill = factor(year))) +
  coord_flip()
```


## what about distribution of pct_capacity of the show

Interesting:
  It looks like each theatre owns its own best show
```{r}
grosses %>% 
  filter(show == "Chicago") 
  
```

```{r}
grosses %>% 
  filter(show == "Aladdin") %>% 
  ggplot()+
  geom_histogram(aes(pct_capacity))
```

Can one show be present at other theatres?
Yes
```{r}
grosses %>% 
  filter(show == "Hamlet")
```

```{r}
grosses %>% 
  group_by(theatre, week_ending) %>% 
  summarise(sum_perform = sum(performances)) %>% 
  distinct(sum_perform) %>% 
  arrange(desc(sum_perform))

# ，每个剧院一天最多25场
```
```{r}
grosses %>% 
  mutate(year = year(date(week_ending)),
         month = month(date(week_ending))) %>% 
  group_by(theatre, year) %>% 
  summarise(yearly = sum(performances)) %>% 
  arrange(desc(yearly)) %>% 
  ggplot() +
  geom_histogram(aes(yearly))
```



```{r fig.height=18, fig.width=12}
grosses %>% 
  group_by(theatre, show) %>% 
  summarise(sum_perform = sum(performances))%>% 
  ungroup() %>% 
  ggplot()+
  geom_col(aes(sum_perform, reorder(theatre, sum_perform), fill = show))+
  theme(legend.position = "none")

```


# Seasonality
### let's check if each week has the same amount of performance
Interesting!:
  the 1st and 2nd week are actually in top10 of broadway history.
  probably it was so new.
  what is the distribution of performances like? can that reflect people's enthuasism?
```{r fig.height=8, fig.width=16}
grosses %>% 
  group_by(week_number) %>% # group_by week number shows you the trend of the year in total
  summarise(weekly_perfom = sum(performances)) %>% 
  arrange(desc(weekly_perfom)) %>% 
  ggplot(aes(factor(week_number), weekly_perfom)) +
  geom_col()+
  labs(title = "Performances trend of different weeks in general")

```

## what about the trend of performance every year?

```{r fig.height=8, fig.width=16}
grosses %>% 
  group_by(week_ending) %>% # group_by week number shows you the trend of the year in total
  summarise(weekly_perfom = sum(performances)) %>% 
  arrange(desc(weekly_perfom)) %>% 
  ggplot(aes(week_ending, weekly_perfom)) +
  geom_line()
```
```{r fig.height=8, fig.width=12}
grosses %>% 
  mutate(year = year(date(week_ending)),
         month = month(date(week_ending))) %>% 
  group_by(year) %>% 
  summarise(yearly = sum(performances)) %>%
  ggplot(aes(year, yearly)) +
  geom_col()+
  expand_limits(y = 0)
  
```




## which show has the most weekly performance? why?